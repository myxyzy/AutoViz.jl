<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cameras · AutoViz.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">AutoViz.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../basics/">AutoViz Basics</a></li><li class="is-active"><a class="tocitem" href>Cameras</a><ul class="internal"><li><a class="tocitem" href="#Default-camera:-fit-to-content-1"><span>Default camera: fit to content</span></a></li><li><a class="tocitem" href="#Static-Camera-1"><span>Static Camera</span></a></li><li><a class="tocitem" href="#Target-Follow-Camera-1"><span>Target Follow Camera</span></a></li><li><a class="tocitem" href="#Scene-Follow-Camera-1"><span>Scene Follow Camera</span></a></li><li><a class="tocitem" href="#Zooming-Camera-1"><span>Zooming Camera</span></a></li><li><a class="tocitem" href="#Composed-Camera-1"><span>Composed Camera</span></a></li><li><a class="tocitem" href="#Custom-Camera-1"><span>Custom Camera</span></a></li></ul></li><li><a class="tocitem" href="../overlays/">Overlays</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../api/">API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Cameras</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cameras</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sisl/AutoViz.jl/blob/master/docs/lit/tutorials/cameras.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Cameras-1"><a class="docs-heading-anchor" href="#Cameras-1">Cameras</a><a class="docs-heading-anchor-permalink" href="#Cameras-1" title="Permalink"></a></h1><p><a href="https://nbviewer.jupyter.org/github/sisl/AutoViz.jl/blob/gh-pages/dev/notebooks/cameras.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt/></a></p><p>In this section, we will showcase the cameras that are supported by <code>AutoViz.jl</code>.</p><p>All cameras make use of the <code>CameraState</code> object to represent the internal camera state.</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>CameraState</code>. Check Documenter&#39;s build log for details.</p></div></div><p>The following camera types are supported by <code>AutoViz</code>: <code>StaticCamera</code>, <code>TargetFollowCamera</code>, <code>SceneFollowCamera</code>, <code>ZoomingCamera</code>, <code>ComposedCamera</code>. The keyword arguments accepted by the <code>CameraState</code> object can also be passed to the constructors of these cameras, and they will be forwarded to the internal camera state. Now, we will show how the different cameras behave based on the simple stadium example.</p><p>First, we prepare a sequence of scenes visualize</p><pre><code class="language-julia">using AutomotiveDrivingModels
using AutoViz

nlanes = 4
nveh = 5
nticks = 100
timestep = 0.1

roadway = gen_stadium_roadway(nlanes)

scene = Frame([Entity(VehicleState(
    Frenet(roadway[LaneTag(1,rand(1:nlanes))], 10.0*i), roadway, 4.0 + 2.0rand()
), VehicleDef(), i) for i in 1:nveh])

models = Dict((
    i =&gt; LatLonSeparableDriver(ProportionalLaneTracker(), IntelligentDriverModel())
    for i in 1:nveh
))
set_desired_speed!.(values(models), 8.0 .+ 4.0rand(nveh))


scenes = simulate(scene, roadway, models, nticks, timestep)</code></pre><p>The following helper function takes care of generating an animation from a sequence of scenes, using a given <code>camera</code>. Note that for <code>camera=nothing</code>, the render function attempts to fit all the renderable objects on the canvas.</p><pre><code class="language-julia">using Reel

function animate(roadway, scenes, camera=nothing)
    animation = roll(fps=1.0/timestep, duration=nticks*timestep) do t, dt
        i = Int(floor(t/dt)) + 1
        update_camera!(camera, scenes[i])
        renderables = [
            roadway, scenes[i],
            RenderableOverlay(IDOverlay(x_off=-2, y_off=1), scenes[i], roadway),
        ]
        render(renderables, camera=camera)
    end
    return animation
end</code></pre><p>The call to <code>update_camera!(camera, scenes[i])</code> is important as it allows the internal camera state to be updated based on the positions of the vehicles.</p><h2 id="Default-camera:-fit-to-content-1"><a class="docs-heading-anchor" href="#Default-camera:-fit-to-content-1">Default camera: fit to content</a><a class="docs-heading-anchor-permalink" href="#Default-camera:-fit-to-content-1" title="Permalink"></a></h2><p>The default camera uses the render instructions that are stored inside the <code>RenderModel</code> in order to compute a bounding box which holds all renderable objects.</p><pre><code class="language-julia">animation = animate(roadway, scenes);</code></pre><pre><code class="language-none">&quot;stadium_cam_default.gif&quot;</code></pre><p><img src="../stadium_cam_default.gif" alt="default camera"/></p><p>Note that some renderable objects (such as custom objects) may not be considered by the default fit to content camera when the bounding box is computed. Therefore, they may be cut off.</p><h2 id="Static-Camera-1"><a class="docs-heading-anchor" href="#Static-Camera-1">Static Camera</a><a class="docs-heading-anchor-permalink" href="#Static-Camera-1" title="Permalink"></a></h2><p>A static camera maintains its position, zoom and rotation. It is the only camera that doesn&#39;t change its state when calling <code>update_camera!()</code>.</p><pre><code class="language-julia">animation = animate(roadway, scenes, StaticCamera(zoom=5.))</code></pre><pre><code class="language-none">&quot;stadium_cam_static_default.gif&quot;</code></pre><p><img src="../stadium_cam_static_default.gif" alt="static default camera"/></p><p>We can pass in zoom, position and rotation parameters in order to change the camera state.</p><pre><code class="language-julia">animation = animate(
    roadway, scenes,
    StaticCamera(position=VecE2(20.,10.), rotation=.2, zoom=8.)
)</code></pre><pre><code class="language-none">&quot;stadium_cam_static_custom.gif&quot;</code></pre><p><img src="../stadium_cam_static_custom.gif" alt="static custom camera"/></p><h2 id="Target-Follow-Camera-1"><a class="docs-heading-anchor" href="#Target-Follow-Camera-1">Target Follow Camera</a><a class="docs-heading-anchor-permalink" href="#Target-Follow-Camera-1" title="Permalink"></a></h2><p>In many applications, we are interested in tracking one particular vehicle. To do this, we can use a <code>TargetFollowCamera</code> which follows a vehicle with a given ID. Let&#39;s follow the vehicle with ID <code>3</code>:</p><pre><code class="language-julia">animation = animate(roadway, scenes, TargetFollowCamera(3, zoom=5.))</code></pre><pre><code class="language-none">&quot;stadium_cam_target.gif&quot;</code></pre><p><img src="../stadium_cam_target.gif" alt="target follow camera"/></p><p>Sometimes, it is desireable fix the x or y position of the camera. For example, we can use the <code>TargetFollowCamera</code> to track a vehicle horizontally (in x direction), while keeping the vertical position (y direction) fixed. To do this, we simply provide a fixed value for the corresponding keyword argument <code>y</code>.</p><pre><code class="language-julia">animation = animate(roadway, scenes, TargetFollowCamera(3, zoom=10., y=40.))</code></pre><pre><code class="language-none">&quot;stadium_cam_target_y.gif&quot;</code></pre><p><img src="../stadium_cam_target_y.gif" alt="target follow camera, fixed y"/></p><h2 id="Scene-Follow-Camera-1"><a class="docs-heading-anchor" href="#Scene-Follow-Camera-1">Scene Follow Camera</a><a class="docs-heading-anchor-permalink" href="#Scene-Follow-Camera-1" title="Permalink"></a></h2><p>In contrast to the <code>TargetFollowCamera</code>, the <code>SceneFollowCamera</code> tracks the center of mass of all the vehicles in a scene. The <code>padding</code> parameter specifies how man metres of padding there should be around the vehicles in the scene</p><pre><code class="language-julia">animation = animate(roadway, scenes, SceneFollowCamera(padding=4.))</code></pre><pre><code class="language-none">&quot;stadium_cam_scene.gif&quot;</code></pre><p><img src="../stadium_cam_scene.gif" alt="scene follow camera"/></p><p>If we desire to follow the scene, but fix the zoom level, we can do so by passing in the corresponding keyword argument <code>zoom</code>.</p><pre><code class="language-julia">animation = animate(roadway, scenes, SceneFollowCamera(zoom=20.))</code></pre><pre><code class="language-none">&quot;stadium_cam_scene_zoom.gif&quot;</code></pre><p><img src="../stadium_cam_scene_zoom.gif" alt="scene follow camera"/></p><h2 id="Zooming-Camera-1"><a class="docs-heading-anchor" href="#Zooming-Camera-1">Zooming Camera</a><a class="docs-heading-anchor-permalink" href="#Zooming-Camera-1" title="Permalink"></a></h2><p>The zooming camera changes its zoom level by an increment <code>dz</code> anytime the <code>update_camera!()</code> function is called, until a zoom level of <code>zoom_target</code> is reached.</p><pre><code class="language-julia">animation = animate(roadway, scenes, ZoomingCamera(zoom_target=20., dz=0.4, zoom=2.))</code></pre><pre><code class="language-none">&quot;stadium_cam_zooming.gif&quot;</code></pre><p><img src="../stadium_cam_zooming.gif" alt="zooming camera"/></p><h2 id="Composed-Camera-1"><a class="docs-heading-anchor" href="#Composed-Camera-1">Composed Camera</a><a class="docs-heading-anchor-permalink" href="#Composed-Camera-1" title="Permalink"></a></h2><p>Finally, the <code>ComposedCamera</code> can be used to combine different camera behaviors. For example, one can use the <code>TargetFollowCamera</code> together with the <code>ZoomingCamera</code> in order to follow a vehicle and zoom in on it. The constructor of the <code>CompostedCamera</code> takes an array of cameras which are applied in the same sequence as they are provided in the array.</p><pre><code class="language-julia">animation = animate(roadway, scenes, ComposedCamera([
    TargetFollowCamera(3),
    ZoomingCamera(zoom_target=25., dz=0.4, zoom=1.),
]))</code></pre><pre><code class="language-none">&quot;stadium_cam_composed.gif&quot;</code></pre><p><img src="../stadium_cam_composed.gif" alt="composed camera"/></p><h2 id="Custom-Camera-1"><a class="docs-heading-anchor" href="#Custom-Camera-1">Custom Camera</a><a class="docs-heading-anchor-permalink" href="#Custom-Camera-1" title="Permalink"></a></h2><p>Finally, we will show how to build a custom camera. We will build a camera whose angle is always aligned with the axis of the target vehicle with ID <code>target_id</code></p><pre><code class="language-julia">mutable struct TargetRotateCamera{I} &lt;: Camera
    state::CameraState
    target_id::I
end
TargetRotateCamera(target_id; kwargs...) = TargetRotateCamera(CameraState(;kwargs...), target_id)</code></pre><p>In the <code>update_camera!()</code> function, we need to set the camera rotation to be the same as the vehicle yaw angle</p><pre><code class="language-julia">function AutoViz.update_camera!(camera::TargetRotateCamera{I}, scene::Frame{E}) where {I,E&lt;:Entity}
    target = get_by_id(scene, camera.target_id)
    yaw = posg(target.state)[3]
    set_camera!(camera.state, rotation=-yaw)
    return camera.state
end</code></pre><p>Finally, we can use our custom camera just like the other cameras</p><pre><code class="language-julia">animation = animate(roadway, scenes, TargetRotateCamera(3, zoom=5.))</code></pre><pre><code class="language-none">&quot;stadium_cam_custom.gif&quot;</code></pre><p><img src="../stadium_cam_custom.gif" alt="custom camera"/></p><p>Also, we can combine the camera with other cameras to our liking</p><pre><code class="language-julia">animation = animate(roadway, scenes, ComposedCamera([
    TargetFollowCamera(3),
    TargetRotateCamera(3),
    ZoomingCamera(zoom_target=25., dz=0.4, zoom=1.),
]))</code></pre><pre><code class="language-none">&quot;stadium_cam_composed_custom.gif&quot;</code></pre><p><img src="../stadium_cam_composed_custom.gif" alt="composed camera"/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basics/">« AutoViz Basics</a><a class="docs-footer-nextpage" href="../overlays/">Overlays »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 19 March 2020 12:57">Thursday 19 March 2020</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
